<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nivarya Setu | A bridge to smart investing</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Icons & Fonts -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- TradingView -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <!-- Firebase Integration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

        async function initFirebase() {
            try {
                const res = await fetch('/api/config');
                const data = await res.json();
                if (data.firebase && data.firebase.apiKey !== 'your_api_key') {
                    const app = initializeApp(data.firebase);
                    const auth = getAuth(app);
                    window.FirebaseAuth = { auth, signInWithPopup, GoogleAuthProvider };
                    console.log("Firebase Auth Initialized");
                }
            } catch (e) { console.error("Firebase Init Error:", e); }
        }
        initFirebase();
    </script>

    <style>
        :root {
            --bg-body: #08090b;
            --bg-panel: #111419;
            --bg-card: #161a22;
            --border: rgba(255, 255, 255, 0.05);
            --text-main: #ffffff;
            --text-light: #808a9d;
            --blue: #00d09c;
            /* Groww Green */
            --red: #eb5b3c;
            --green: #00d09c;
            --bg-active: rgba(0, 208, 156, 0.08);
            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --font: 'Inter', system-ui, -apple-system, sans-serif;
            --font-mono: 'Roboto Mono', monospace;
            --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font);
            -webkit-font-smoothing: antialiased;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: var(--bg-body);
            color: var(--text-main);
            font-size: 13px;
            display: flex;
            flex-direction: column;
        }

        .header {
            height: 72px;
            flex-shrink: 0;
            padding: 0 40px;
            background: #08090b;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
        }

        .logo {
            font-weight: 800;
            font-size: 18px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            letter-spacing: -0.5px;
        }

        .logo i {
            color: var(--blue);
            font-size: 22px;
        }

        .logo span {
            font-weight: 300;
            opacity: 0.5;
        }

        .indices {
            display: flex;
            gap: 15px;
            margin-left: 40px;
        }

        .index-item {
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 11px;
            background: #151921;
            padding: 6px 14px;
            border-radius: 4px;
            border: 1px solid var(--border);
        }

        .index-val {
            font-family: var(--font-mono);
            font-weight: 600;
        }

        .index-chg {
            font-weight: 600;
        }

        .nav {
            display: flex;
            gap: 8px;
            margin-left: 40px;
            flex: 1;
            align-items: center;
        }

        .nav-item {
            color: var(--text-light);
            text-decoration: none;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 100px;
            transition: var(--transition);
            white-space: nowrap;
        }

        .nav-item:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-item.active {
            color: #000;
            background: var(--blue);
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            cursor: pointer;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--blue);
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 12px;
        }

        .main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 320px;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            background: var(--bg-body);
            transition: 0.3s;
        }

        .search-area {
            padding: 20px;
            position: relative;
        }

        .search-area i {
            position: absolute;
            left: 34px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            pointer-events: none;
            opacity: 0.5;
        }

        .search-input {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 12px 12px 40px;
            color: #fff;
            width: 100%;
            outline: none;
            font-size: 13px;
            transition: 0.2s;
        }

        .search-input:focus {
            border-color: var(--blue);
            background: #1a1f2b;
        }

        .stock-list {
            flex: 1;
            overflow-y: auto;
        }

        .stock-item {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.02);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: 0.2s;
            border-left: 3px solid transparent;
        }

        .stock-item:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .stock-item.active {
            background: var(--bg-active);
            border-left-color: var(--blue);
        }

        .symbol-info div:first-child {
            font-weight: 700;
            font-size: 14px;
            color: #fff;
        }

        .symbol-info div:last-child {
            font-size: 10px;
            color: var(--text-light);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            opacity: 0.6;
        }

        .price-info {
            text-align: right;
            margin-left: auto;
        }

        .price-val {
            font-weight: 700;
            font-size: 14px;
            font-family: var(--font-mono);
        }

        .price-chg {
            font-size: 11px;
            margin-top: 2px;
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-body);
        }

        .info-bar {
            height: 72px;
            padding: 0 32px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            background: var(--bg-body);
        }

        .stock-title {
            font-size: 18px;
            font-weight: 800;
            color: #fff;
        }

        .stock-ltp {
            font-size: 24px;
            font-weight: 700;
            font-family: var(--font-mono);
            margin-left: 24px;
        }

        .actions {
            margin-left: auto;
            display: flex;
            gap: 12px;
        }

        .panels {
            height: 35vh;
            min-height: 200px;
            background: var(--bg-panel);
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            padding: 0 15px;
            gap: 10px;
        }

        .panel-tab {
            padding: 12px 16px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            font-size: 11px;
            text-transform: uppercase;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .panel-tab:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.03);
        }

        .panel-tab.active {
            color: var(--blue);
            border-bottom-color: var(--blue);
        }

        .table-area {
            flex: 1;
            overflow: auto;
            padding-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        .step-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin: 48px 0;
        }

        .step-card {
            background: #0a0a0a;
            border: 1px solid var(--border);
            padding: 40px;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            transition: 0.3s;
        }

        .step-card:hover {
            border-color: var(--blue);
            transform: translateY(-5px);
        }

        .step-num {
            position: absolute;
            right: -10px;
            bottom: -20px;
            font-size: 120px;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.03);
            line-height: 1;
        }

        .faq-container {
            max-width: 900px;
            margin: 48px auto;
        }

        .faq-item {
            background: #0a0a0a;
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .faq-header {
            padding: 24px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .faq-header:hover {
            background: #111;
        }

        .faq-answer {
            padding: 0 32px 24px;
            color: var(--text-light);
            font-size: 15px;
            line-height: 1.6;
            display: none;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .faq-item.active .faq-header i {
            transform: rotate(180deg);
        }

        .community-card {
            background: #0a0a0a;
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .disclosure-text {
            font-size: 11px;
            color: var(--text-light);
            opacity: 0.5;
            line-height: 1.8;
            margin-top: 40px;
            text-align: justify;
        }

        th {
            font-size: 10px;
            color: var(--text-light);
            font-weight: 700;
            text-align: left;
            padding: 12px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-panel);
            position: sticky;
            top: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        td {
            font-size: 12px;
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.02);
            font-family: var(--font-mono);
            font-weight: 500;
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.01);
        }

        .modal-header {
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .close-btn {
            cursor: pointer;
            font-size: 18px;
            opacity: 0.5;
            transition: 0.2s;
        }

        .close-btn:hover {
            opacity: 1;
        }

        .modal-body {
            padding: 24px;
        }

        .switch-toggle {
            display: flex;
            background: var(--bg-body);
            padding: 4px;
            border-radius: 8px;
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .switch-opt {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-light);
            transition: 0.2s;
        }

        .switch-opt.active {
            background: var(--bg-panel);
            color: var(--blue);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* --- DASHBOARD & CONTENT --- */
        .center-area {
            display: flex;
            flex: 1;
            overflow: hidden;
            background: #000;
        }

        .chart-container {
            flex: 1;
            position: relative;
        }

        .depth-container {
            width: 320px;
            flex-shrink: 0;
            background: var(--bg-panel);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .depth-header {
            padding: 15px 20px;
            font-weight: 700;
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-light);
            border-bottom: 1px solid var(--border);
            letter-spacing: 1px;
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            width: 440px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
            overflow: hidden;
        }

        .modal-header {
            padding: 20px 24px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header.sell {
            border-bottom-color: var(--red);
        }

        .modal-title {
            font-size: 16px;
            font-weight: 800;
        }

        .modal-body {
            padding: 24px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            font-size: 11px;
            color: var(--text-light);
            font-weight: 700;
            margin-bottom: 8px;
            display: block;
            text-transform: uppercase;
        }

        .input-field {
            background: var(--bg-body);
            border: 1px solid var(--border);
            border-radius: 8px;
            height: 44px;
            color: #fff;
            padding: 0 16px;
            width: 100%;
            outline: none;
            font-family: 'Roboto Mono', monospace;
        }

        .input-field:focus {
            border-color: var(--blue);
        }

        .action-btn {
            height: 40px;
            padding: 0 20px;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-buy {
            background: var(--blue);
            color: #000;
        }

        .btn-sell {
            background: rgba(255, 82, 82, 0.1);
            color: var(--red);
            border: 1px solid var(--red);
        }

        .btn-sell:hover {
            background: var(--red);
            color: #fff;
        }

        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
            width: auto;
            max-width: 400px;
        }

        .toast {
            pointer-events: auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 16px 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border-left: 6px solid var(--blue);
            min-width: 320px;
            animation: slideIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            transition: 0.3s;
        }

        .toast.error {
            border-left-color: var(--red);
        }

        .profile-dropdown {
            position: absolute;
            top: 120%;
            right: 0;
            width: 220px;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            z-index: 2000;
            overflow: hidden;
            animation: fadeIn 0.2s;
        }

        .dropdown-info {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
        }

        .dropdown-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-light);
            transition: 0.2s;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .dropdown-item i {
            width: 16px;
            opacity: 0.7;
        }

        .funds-card {
            background: linear-gradient(135deg, var(--bg-panel) 0%, #1a1e26 100%);
            padding: 32px;
            border-radius: 16px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .price-val.text-up {
            color: var(--green);
        }

        .price-val.text-down {
            color: var(--red);
        }

        .price-chg.text-up {
            color: var(--green);
        }

        .price-chg.text-down {
            color: var(--red);
        }

        .badge {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-light);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            height: 20px;
        }

        .badge.buy {
            background: rgba(0, 208, 156, 0.15);
            color: var(--green);
        }

        .badge.sell {
            background: rgba(235, 91, 60, 0.15);
            color: var(--red);
        }

        .text-up {
            color: var(--green) !important;
        }

        .text-down {
            color: var(--red) !important;
        }

        /* --- LANDING PAGE OVERHAUL --- */
        .landing-page {
            position: fixed;
            inset: 0;
            background: #08090b;
            overflow-y: auto;
            z-index: 5000;
        }

        .landing-page .header {
            background: #08090b;
            border-bottom: 1px solid var(--border);
            height: 80px;
            padding: 0 40px;
            position: sticky;
            top: 0;
            z-index: 6000;
        }

        .landing-page .header .nav-item {
            background: transparent;
            border: none;
            height: auto;
            padding: 10px 20px;
        }

        .landing-page .header .landing-btn {
            height: auto;
            border-radius: var(--radius-sm);
        }

        .hero {
            min-height: 90vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 100px 20px;
            text-align: center;
        }

        .hero h1 {
            font-size: 4.5rem;
            font-weight: 800;
            letter-spacing: -2px;
            margin-bottom: 24px;
            color: #fff;
            line-height: 1.1;
            max-width: 900px;
        }

        .hero h1 span {
            color: var(--blue);
        }

        .hero p {
            color: var(--text-light);
            font-size: 1.25rem;
            max-width: 700px;
            margin-bottom: 48px;
            line-height: 1.6;
        }

        .landing-btn {
            background: var(--blue);
            color: #000;
            padding: 18px 48px;
            border-radius: var(--radius-sm);
            font-weight: 700;
            font-size: 18px;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            box-shadow: none !important;
        }

        .landing-btn:hover {
            background: #00b084;
            transform: translateY(-1px);
        }

        .landing-btn.secondary {
            background: transparent;
            color: #fff;
            border: 1px solid var(--border);
        }

        .landing-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.03);
            border-color: #fff;
        }

        .feat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 32px;
            max-width: 1200px;
            padding: 0 20px 100px;
            margin: 0 auto;
        }

        .feat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 40px;
            border-radius: var(--radius);
            transition: var(--transition);
            text-align: left;
        }

        .feat-card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            background: #1c212b;
        }

        .feat-card i {
            font-size: 32px;
            margin-bottom: 20px;
            color: var(--blue);
        }

        /* Bottom Nav Removed */

        .b-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-light);
            font-size: 10px;
            font-weight: 700;
            transition: 0.2s;
        }

        .b-nav-item.active {
            color: var(--blue);
        }

        .b-nav-item i {
            font-size: 20px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {

            .nav,
            .indices,
            .sidebar {
                display: none;
            }

            .bottom-nav {
                display: flex;
            }

            .hero h1 {
                font-size: 3rem;
            }

            .feat-grid {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 0 20px;
            }
        }

        .input-group {
            flex: 1;
        }

        .input-label {
            display: block;
            font-size: 10px;
            margin-bottom: 8px;
            color: var(--text-light);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-field {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
            outline: none;
            transition: 0.2s;
            background: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-mono);
        }

        .input-field:focus {
            border-color: var(--blue);
        }

        .modal-footer {
            padding: 16px 24px;
            background: var(--bg-body);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toast-container {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: var(--bg-panel);
            width: 320px;
            padding: 16px 20px;
            border-radius: 4px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: start;
            gap: 16px;
            border-left: 4px solid var(--border);
            animation: slideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: var(--text-main);
            border: 1px solid var(--border);
        }

        .toast.success {
            border-left-color: var(--green);
        }

        .toast.error {
            border-left-color: var(--red);
        }

        .text-up {
            color: var(--green);
        }

        .text-down {
            color: var(--red);
        }

        .error-box {
            padding: 20px;
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid var(--red);
            color: var(--red);
            margin: 20px;
            border-radius: 4px;
            white-space: pre-wrap;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes flashGreen {
            0% {
                background-color: rgba(0, 208, 156, 0.2);
            }

            100% {
                background-color: transparent;
            }
        }

        @keyframes flashRed {
            0% {
                background-color: rgba(235, 91, 60, 0.2);
            }

            100% {
                background-color: transparent;
            }
        }

        @media (max-width: 768px) {

            .nav,
            .indices {
                display: none;
            }

            .header {
                padding: 0 20px;
            }

            .hero h1 {
                font-size: 3rem;
            }

            .feat-grid {
                grid-template-columns: 1fr;
            }

            .sidebar {
                width: 100%;
                border-right: none;
            }

            .main {
                flex-direction: column;
            }
        }

        .input-group {
            flex: 1;
        }

        .input-label {
            display: block;
            font-size: 10px;
            margin-bottom: 8px;
            color: var(--text-light);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-field {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
            outline: none;
            transition: 0.2s;
            background: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-mono);
        }

        .input-field:focus {
            border-color: var(--blue);
        }

        .modal-footer {
            padding: 16px 24px;
            background: var(--bg-body);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toast-container {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: var(--bg-panel);
            width: 320px;
            padding: 16px 20px;
            border-radius: 4px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: start;
            gap: 16px;
            border-left: 4px solid var(--border);
            animation: slideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: var(--text-main);
            border: 1px solid var(--border);
        }

        .toast.success {
            border-left-color: var(--green);
        }

        .toast.error {
            border-left-color: var(--red);
        }

        .text-up {
            color: var(--green);
        }

        .text-down {
            color: var(--red);
        }

        .error-box {
            padding: 20px;
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid var(--red);
            color: var(--red);
            margin: 20px;
            border-radius: 4px;
            white-space: pre-wrap;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes flashGreen {
            0% {
                background-color: rgba(0, 208, 156, 0.2);
            }

            100% {
                background-color: transparent;
            }
        }

        @keyframes flashRed {
            0% {
                background-color: rgba(235, 91, 60, 0.2);
            }

            100% {
                background-color: transparent;
            }
        }

        .bottom-nav {
            display: none;
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
                position: absolute;
                width: 80%;
                height: 100%;
                top: 48px;
                border-right: 1px solid var(--border);
            }
        }

        /* --- LANDING PAGE --- */
        .landing-page {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top right, #1a1a2e, #0d0d0d);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            z-index: 500;
        }

        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
        }

        .landing-page {
            background: #000;
            color: #fff;
            overflow-x: hidden;
        }

        .landing-section {
            padding: 80px 5%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .hero-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 90vh;
            gap: 40px;
        }

        .hero-content {
            flex: 1;
            max-width: 600px;
        }

        .hero-visual {
            flex: 1.2;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hero-visual .hero-img {
            width: 100%;
            max-width: 800px;
            border-radius: 20px;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hero-visual .hero-img:hover {
            transform: scale(1.02);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .hero-content h1 {
            font-size: 72px;
            line-height: 1.05;
            font-weight: 900;
            margin-bottom: 32px;
            text-align: left;
            letter-spacing: -2px;
        }

        .hero-content h1 span {
            color: var(--blue);
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-light);
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            transition: 0.2s;
            width: fit-content;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            transform: translateX(-4px);
        }

        .hero-content p {
            font-size: 20px;
            color: var(--text-light);
            margin-bottom: 48px;
        }

        .input-bar {
            display: flex;
            background: #111;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 8px;
            max-width: 500px;
            margin-bottom: 32px;
        }

        .input-bar input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            padding: 0 20px;
            font-size: 16px;
            outline: none;
        }

        .input-bar button {
            background: var(--blue);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
        }

        .promo-badges {
            display: flex;
            gap: 20px;
        }

        .promo-badge {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            padding: 16px 24px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .promo-val {
            font-size: 24px;
            font-weight: 800;
            color: var(--blue);
        }

        .promo-txt {
            font-size: 11px;
            color: var(--text-light);
            line-height: 1.4;
        }

        /* --- MTF COMPARISON --- */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: #0a0a0a;
            border-radius: 20px;
            overflow: hidden;
            margin-top: 40px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 24px;
            text-align: center;
            border-bottom: 1px solid #1a1a1a;
        }

        .col-highlight {
            background: rgba(55, 125, 255, 0.05);
            border: 1px solid var(--blue);
        }

        /* --- PLATFORM CARDS --- */
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-top: 48px;
        }

        .platform-card {
            background: #0e0e0e;
            border: 1px solid var(--border);
            padding: 32px;
            border-radius: 16px;
            transition: 0.3s;
        }

        .platform-card:hover {
            border-color: var(--blue);
            transform: translateY(-8px);
        }

        .sticky-footer-bar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            padding: 12px 24px;
            border-radius: 100px;
            display: flex;
            align-items: center;
            gap: 24px;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        /* --- AUTH PAGE --- */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #000;
            padding: 20px;
        }

        .auth-card {
            background: var(--bg-panel);
            width: 100%;
            max-width: 400px;
            padding: 40px;
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .auth-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
        }

        /* --- BASKETS (STOCKCASES) --- */
        .basket-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .basket-card {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .basket-card:hover {
            border-color: var(--blue);
            transform: translateY(-3px);
        }

        .basket-tag {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--bg-active);
            color: var(--blue);
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        /* --- CHART TRADING OVERLAY --- */
        .chart-trade-panel {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 50;
        }

        .ct-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 12px;
        }

        .ct-buy {
            background: var(--blue);
            box-shadow: 0 0 10px rgba(55, 125, 255, 0.4);
        }

        .ct-sell {
            background: var(--red);
            box-shadow: 0 0 10px rgba(235, 91, 60, 0.4);
        }

        .sidebar.mobile-open {
            display: flex;
            position: absolute;
            left: 0;
            z-index: 100;
            width: 80% !important;
            height: calc(100% - 108px) !important;
            top: 48px;
        }

        /* Bottom Nav Section Removed */
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, Component } = React;

        class ErrorBoundary extends Component {
            constructor(props) { super(props); this.state = { hasError: false, error: null }; }
            static getDerivedStateFromError(error) { return { hasError: true, error }; }
            componentDidCatch(error, errorInfo) { console.error(error, errorInfo); }
            render() { return this.state.hasError ? <div className="error-box"><h3>Error</h3><p>{this.state.error.toString()}</p></div> : this.props.children; }
        }

        const ToastContainer = ({ toasts }) => (
            <div className="toast-container"> {toasts.map(t => <div key={t.id} className={`toast ${t.type}`}><div className="toast-icon">{t.type === 'success' ? <i className="fas fa-check-circle text-up" /> : <i className="fas fa-exclamation-circle text-down" />}</div><div><h4 style={{ fontSize: '13px', marginBottom: '4px', fontWeight: '600' }}>{t.title}</h4><p style={{ fontSize: '11px', color: 'var(--text-light)' }}>{t.message}</p></div></div>)} </div>
        );

        const Sparkline = ({ color }) => {
            const points = useMemo(() => { let data = [50]; for (let i = 0; i < 20; i++) data.push(data[i] + (Math.random() - 0.5) * 10); const min = Math.min(...data), max = Math.max(...data); return data.map((d, i) => `${(i / 20) * 60},${30 - ((d - min) / (max - min)) * 30}`).join(' '); }, []);
            return <svg width="60" height="30" style={{ opacity: 0.8 }}><polyline points={points} fill="none" stroke={color} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" /></svg>;
        };
        const DonutChart = ({ data }) => {
            const total = data.reduce((a, b) => a + b.value, 0);
            let cum = 0; const segs = data.map((d, i) => { const start = (cum / total) * 360; cum += d.value; const end = (cum / total) * 360; const large = end - start > 180 ? 1 : 0; const x1 = 50 + 40 * Math.cos(Math.PI * (start - 90) / 180); const y1 = 50 + 40 * Math.sin(Math.PI * (start - 90) / 180); const x2 = 50 + 40 * Math.cos(Math.PI * (end - 90) / 180); const y2 = 50 + 40 * Math.sin(Math.PI * (end - 90) / 180); return <path key={i} d={`M50,50 L${x1},${y1} A40,40 0 ${large},1 ${x2},${y2} Z`} fill={d.color} /> }); return <svg viewBox="0 0 100 100" width="120" height="120">{segs}<circle cx="50" cy="50" r="25" fill="var(--bg-panel)" /></svg>;
        };

        const EmptyState = ({ icon, text }) => (<div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', color: 'var(--text-light)', opacity: 0.5, padding: '40px' }}><i className={`fas ${icon}`} style={{ fontSize: '32px', marginBottom: '10px' }}></i><div style={{ fontSize: '12px' }}>{text}</div></div>);

        const LandingPage = ({ onStart }) => {
            const [mobile, setMobile] = useState('');
            const [activeFaq, setActiveFaq] = useState(null);
            return (
                <div className="landing-page">
                    <div className="header">
                        <div className="logo" onClick={() => onStart('LANDING')}>
                            <i className="fas fa-landmark"></i>
                            <div style={{ display: 'flex', flexDirection: 'column', lineHeight: '1' }}>
                                <div style={{ display: 'flex', gap: '4px', fontSize: '18px' }}>NIVARYA <span style={{ fontWeight: '300', opacity: 0.5 }}>SETU</span></div>
                                <div style={{ fontSize: '9px', fontWeight: '500', opacity: 0.4, letterSpacing: '0.3px', marginTop: '2px' }}>A bridge to smart investing</div>
                            </div>
                        </div>
                        <div style={{ marginLeft: 'auto', display: 'flex', gap: '15px', alignItems: 'center' }}>
                            <button className="nav-item" style={{ fontSize: '14px', fontWeight: '600' }} onClick={() => onStart('LOGIN')}>Login</button>
                            <button className="landing-btn" style={{ padding: '10px 24px', fontSize: '13px', borderRadius: '8px', boxShadow: 'none' }} onClick={() => onStart('SIGNUP')}>Sign Up</button>
                        </div>
                    </div>

                    <div className="landing-section hero-section">
                        <div className="hero-content" style={{ textAlign: 'left' }}>
                            <div style={{ textTransform: 'uppercase', color: 'var(--blue)', fontWeight: '800', fontSize: '12px', letterSpacing: '2px', marginBottom: '24px' }}>Now live with NSE & BSE</div>
                            <h1>Open Your <br /><span>Free Demat Account</span></h1>
                            <p style={{ maxWidth: '500px', margin: '0 0 48px 0', textAlign: 'left' }}>Trade & Invest with the next generation platform built for serious wealth creators.</p>

                            <div className="input-bar" style={{ margin: '0 0 32px 0' }}>
                                <input type="text" placeholder="Enter mobile number to start" value={mobile} onChange={e => setMobile(e.target.value)} />
                                <button className="landing-btn" onClick={() => onStart('SIGNUP')}>Open Account Now</button>
                            </div>

                            <div className="promo-badges" style={{ justifyContent: 'flex-start' }}>
                                <div className="promo-badge">
                                    <div className="promo-val">₹0</div>
                                    <div className="promo-txt">A/c Opening, AMC<br />& Mutual Funds</div>
                                </div>
                                <div className="promo-badge">
                                    <div className="promo-val">₹20</div>
                                    <div className="promo-txt">Per order on Equity<br />Intraday, F&O</div>
                                </div>
                            </div>
                        </div>
                        <div className="hero-visual">
                            <img src="assets/hero_mockup.png" className="hero-img" alt="Platform Mockup" />
                        </div>
                    </div>

                    <div className="landing-section" style={{ background: '#050505', paddingTop: '100px', paddingBottom: '100px' }}>
                        <div style={{ textAlign: 'center', marginBottom: '60px' }}>
                            <h2 style={{ fontSize: '42px', fontWeight: '800' }}>Buy More, Pay Less with <span style={{ color: 'var(--blue)' }}>MTF</span></h2>
                            <p style={{ color: 'var(--text-light)', marginTop: '16px' }}>We've slashed interest rates for margin trading to just 0.03% per day!</p>
                        </div>

                        <table className="comparison-table">
                            <thead>
                                <tr>
                                    <th>Feature</th>
                                    <th>Standard Trading</th>
                                    <th className="col-highlight">With Nivarya MTF</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Equity Quantity</td><td>100 Shares</td><td className="col-highlight">400 Shares</td></tr>
                                <tr><td>Required Capital</td><td>₹1,00,000</td><td className="col-highlight">₹25,000</td></tr>
                                <tr><td>Interest Rate</td><td>N/A</td><td className="col-highlight">0.03% / day</td></tr>
                                <tr><td>Profit Potential</td><td>1x</td><td className="col-highlight">4x Leverage</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div className="landing-section" style={{ borderTop: '1px solid var(--border)' }}>
                        <div style={{ display: 'flex', gap: '80px', alignItems: 'center' }}>
                            <div style={{ flex: 1 }}>
                                <h1 style={{ fontSize: '48px', fontWeight: '900', marginBottom: '24px', textAlign: 'left' }}>What's New on <br /><span style={{ color: 'var(--blue)' }}>Nivarya Setu</span></h1>
                                <p style={{ color: 'var(--text-light)', marginBottom: '48px', fontSize: '18px', textAlign: 'left' }}>Next-gen investment tools for modern wealth building.</p>

                                <div style={{ display: 'flex', flexDirection: 'column', gap: '32px' }}>
                                    {[
                                        { icon: 'fa-wifi', title: 'Nivarya WiFi', desc: "Opens order window on App of scrip you're tracking on Web instantly!" },
                                        { icon: 'fa-fire', title: 'Trending on Nivarya', desc: "Discover what other traders & investors are tracking across index segments." },
                                        { icon: 'fa-calendar-alt', title: 'Weekly SIP', desc: "Invest SIP by SIP every week in Direct Mutual Funds and build long-term wealth." }
                                    ].map((item, idx) => (
                                        <div key={idx} style={{ display: 'flex', gap: '24px', alignItems: 'flex-start' }}>
                                            <div style={{ width: '56px', height: '56px', background: 'rgba(55,125,255,0.08)', borderRadius: '16px', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0, border: '1px solid rgba(55,125,255,0.1)' }}>
                                                <i className={`fas ${item.icon}`} style={{ color: 'var(--blue)', fontSize: '20px' }}></i>
                                            </div>
                                            <div>
                                                <h4 style={{ fontSize: '20px', fontWeight: '700', marginBottom: '8px', color: '#fff' }}>{item.title}</h4>
                                                <p style={{ color: 'var(--text-light)', fontSize: '15px', lineHeight: '1.6', margin: 0 }}>{item.desc}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            <div style={{ flex: 1.1 }}>
                                <div style={{ position: 'relative' }}>
                                    <div style={{ position: 'absolute', inset: '-20px', background: 'radial-gradient(circle, rgba(55,125,255,0.15) 0%, transparent 70%)', zIndex: -1 }}></div>
                                    <img src="assets/hero_mockup.png" style={{ width: '100%', borderRadius: '24px', border: '1px solid var(--border)', boxShadow: '0 30px 60px rgba(0,0,0,0.6)' }} alt="Feature Preview" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="landing-section" style={{ background: '#0a0a0a' }}>
                        <div style={{ textAlign: 'center', marginBottom: '60px' }}>
                            <h2 style={{ fontSize: '42px', fontWeight: '800' }}>Made For All <span style={{ color: 'var(--green)' }}>Market Segments</span></h2>
                            <p style={{ color: 'var(--text-light)', marginTop: '16px' }}>All the features you need for any segment you prefer.</p>
                        </div>

                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '32px' }}>
                            <div className="platform-card" style={{ background: '#111' }}>
                                <h3 style={{ fontSize: '24px', fontWeight: '800', marginBottom: '24px', color: 'var(--blue)' }}>Built For Options Trading</h3>
                                <ul style={{ listStyle: 'none', padding: 0, margin: 0, display: 'flex', flexDirection: 'column', gap: '20px' }}>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: 'var(--blue)', marginTop: '4px' }}></i><span>Advanced Option Chain</span></li>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: 'var(--blue)', marginTop: '4px' }}></i><span>Get Pledge Margin</span></li>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: 'var(--blue)', marginTop: '4px' }}></i><span>TradingView Charts</span></li>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: 'var(--blue)', marginTop: '4px' }}></i><span>Trade Directly in Options</span></li>
                                </ul>
                            </div>
                            <div className="platform-card" style={{ background: '#111' }}>
                                <h3 style={{ fontSize: '24px', fontWeight: '800', marginBottom: '24px', color: 'var(--green)' }}>Built For Intraday Trading</h3>
                                <ul style={{ listStyle: 'none', padding: 0, margin: 0, display: 'flex', flexDirection: 'column', gap: '20px' }}>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: 'var(--green)', marginTop: '4px' }}></i><span>Quick Buy & Sell Scalpers</span></li>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: 'var(--green)', marginTop: '4px' }}></i><span>Scalp Like a Pro</span></li>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: 'var(--green)', marginTop: '4px' }}></i><span>Sticky Order Windows</span></li>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: 'var(--green)', marginTop: '4px' }}></i><span>Track Hot Stocks List</span></li>
                                </ul>
                            </div>
                            <div className="platform-card" style={{ background: '#111' }}>
                                <h3 style={{ fontSize: '24px', fontWeight: '800', marginBottom: '24px', color: '#ffb300' }}>Built For Investing</h3>
                                <ul style={{ listStyle: 'none', padding: 0, margin: 0, display: 'flex', flexDirection: 'column', gap: '20px' }}>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: '#ffb300', marginTop: '4px' }}></i><span>Create Wealth with SIPs</span></li>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: '#ffb300', marginTop: '4px' }}></i><span>Earn Higher Returns</span></li>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: '#ffb300', marginTop: '4px' }}></i><span>Pre-Apply for IPOs</span></li>
                                    <li style={{ display: 'flex', gap: '15px' }}><i className="fas fa-check-circle" style={{ color: '#ffb300', marginTop: '4px' }}></i><span>Easily Track Portfolio</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div className="landing-section" style={{ borderTop: '1px solid var(--border)', background: '#050505' }}>
                        <div style={{ textAlign: 'center' }}>
                            <h2 style={{ fontSize: '42px', fontWeight: '800' }}>Open Demat Account in <span style={{ color: 'var(--blue)' }}>3 Steps</span></h2>
                            <div className="step-grid">
                                <div className="step-card">
                                    <i className="fas fa-bolt" style={{ fontSize: '24px', color: 'var(--blue)', marginBottom: '20px' }}></i>
                                    <h3 style={{ fontSize: '20px', marginBottom: '12px' }}>Swift Digital Entry</h3>
                                    <p style={{ fontSize: '14px', color: 'var(--text-light)' }}>Initiate your journey with a lightning-fast, paperless registration in under 60 seconds.</p>
                                    <div className="step-num">1</div>
                                </div>
                                <div className="step-card">
                                    <i className="fas fa-shield-alt" style={{ fontSize: '24px', color: 'var(--blue)', marginBottom: '20px' }}></i>
                                    <h3 style={{ fontSize: '20px', marginBottom: '12px' }}>AI-Powered KYC</h3>
                                    <p style={{ fontSize: '14px', color: 'var(--text-light)' }}>Experience a secure, frictionless verification process designed for the modern age.</p>
                                    <div className="step-num">2</div>
                                </div>
                                <div className="step-card">
                                    <i className="fas fa-chart-line" style={{ fontSize: '24px', color: 'var(--blue)', marginBottom: '20px' }}></i>
                                    <h3 style={{ fontSize: '20px', marginBottom: '12px' }}>Activate Your Vision</h3>
                                    <p style={{ fontSize: '14px', color: 'var(--text-light)' }}>Your bridge to the global markets is ready. Start building your portfolio instantly.</p>
                                    <div className="step-num">3</div>
                                </div>
                            </div>
                            <button className="landing-btn" style={{ padding: '16px 40px', borderRadius: '100px' }} onClick={() => onStart('SIGNUP')}>Start Now <i className="fas fa-arrow-right" style={{ marginLeft: '10px' }}></i></button>
                        </div>
                    </div>


                    <div className="landing-section" style={{ background: '#050505', borderTop: '1px solid var(--border)' }}>
                        <div style={{ textAlign: 'center', marginBottom: '60px' }}>
                            <h2 style={{ fontSize: '42px', fontWeight: '800' }}>Frequently Asked <span style={{ color: 'var(--blue)' }}>Questions</span></h2>
                        </div>
                        <div className="faq-container">
                            {[
                                { q: "What is a Demat Account?", a: "A Demat account holds your shares and securities in electronic format. It is mandatory for trading in stock markets in India." },
                                { q: "Is demat and trading account the same?", a: "No, while a Trading account is used to buy and sell stocks, a Demat account is used to hold them. At Nivarya Setu, we provide both in a single integrated account." },
                                { q: "Benefits of Nivarya Setu demat account?", a: "Direct TradingView integration, zero account opening charges, ultra-low interest on MTF (0.03% daily), and institutional-grade tools for retail traders." },
                                { q: "What is Intraday brokerage and Option brokerage on Nivarya Setu?", a: "We charge zero brokerage on Equity Delivery and a flat ₹20 per trade for Intraday and F&O segments, ensuring transparent and low-cost trading." }
                            ].map((faq, idx) => (
                                <div key={idx} className={`faq-item ${activeFaq === idx ? 'active' : ''}`}>
                                    <div className="faq-header" onClick={() => setActiveFaq(activeFaq === idx ? null : idx)}>
                                        <span style={{ fontWeight: '600' }}>{faq.q}</span>
                                        <i className="fas fa-chevron-down"></i>
                                    </div>
                                    <div className="faq-answer">{faq.a}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="landing-section" style={{ paddingBottom: '80px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', gap: '80px' }}>
                            <div style={{ flex: 1.5 }}>
                                <h3 style={{ fontSize: '24px', fontWeight: '800', marginBottom: '24px' }}>About Nivarya Setu</h3>
                                <p style={{ color: 'var(--text-light)', lineHeight: '1.8', fontSize: '15px' }}>
                                    Nivarya Setu is a state-of-the-art fintech initiative designed to democratize high-performance trading for every Indian investor. We combine institutional-grade technology with a user-centric philosophy to help you navigate the complexities of the financial markets with confidence and clarity.
                                </p>
                                <div style={{ marginTop: '40px', display: 'flex', alignItems: 'center', gap: '12px' }}>
                                    <i className="fas fa-landmark" style={{ color: 'var(--blue)' }}></i>
                                    <span style={{ fontSize: '14px', fontWeight: '700' }}>Your trusted bridge to wealth creation and financial freedom.</span>
                                </div>
                            </div>
                        </div>
                        <div style={{ marginTop: '40px', paddingTop: '40px', borderTop: '1px solid var(--border)', display: 'flex', flexWrap: 'wrap', gap: '24px' }}>
                            {['PRIVACY', 'TERMS', 'RISK', 'REFUND'].map(type => (
                                <span key={type} onClick={() => onStart(type)} style={{ fontSize: '12px', color: 'var(--text-light)', cursor: 'pointer', fontWeight: '600' }}>
                                    {type === 'PRIVACY' ? 'Privacy Policy' : type === 'TERMS' ? 'Terms & Conditions' : type === 'RISK' ? 'Risk Disclosure' : 'Refund Policy'}
                                </span>
                            ))}
                        </div>
                        <div className="disclosure-text">
                            © 2026 Nivarya Setu Financial Services. All rights reserved. <br /><br />
                            Investments in the securities market are subject to market risks. Read all the related documents carefully before investing. Brokerage will not exceed the SEBI prescribed limit.
                        </div>
                    </div>

                    <div className="sticky-footer-bar">
                        <div style={{ fontSize: '14px', fontWeight: '600' }}>Open Demat Account for <span style={{ color: 'var(--blue)' }}>Free</span></div>
                        <div style={{ display: 'flex', gap: '10px' }}>
                            <input type="text" placeholder="Mobile Number" style={{ background: '#111', border: '1px solid var(--border)', borderRadius: '100px', padding: '0 16px', height: '42px', fontSize: '14px', color: '#fff', width: '200px' }} />
                            <button className="landing-btn" style={{ padding: '0 24px', height: '42px', fontSize: '14px', borderRadius: '100px' }} onClick={() => onStart('SIGNUP')}>Open Account Now</button>
                        </div>
                    </div>
                </div>
            );
        };

        const MarketDepth = ({ symbol }) => {
            const [depth, setDepth] = useState({ bids: [], asks: [], total_bid: 0, total_ask: 0 });
            useEffect(() => {
                const fetchDepth = async () => {
                    if (!symbol) return;
                    try {
                        const r = await fetch(`/api/market_depth?symbol=${symbol}`);
                        if (r.ok) setDepth(await r.json());
                    } catch (e) { console.warn("Depth fetch failed"); }
                };
                fetchDepth();
                const t = setInterval(fetchDepth, 2000);
                return () => clearInterval(t);
            }, [symbol]);
            const bidPct = ((depth.total_bid || 0) / (Math.max(depth.total_bid, depth.total_ask) || 1)) * 100;
            return (
                <div className="depth-container"><div className="depth-header">Market Depth</div>
                    <table className="depth-table"><thead><tr><th>BID</th><th>ORD</th><th>QTY</th><th>OFFER</th><th>ORD</th><th>QTY</th></tr></thead><tbody>{[0, 1, 2, 3, 4].map(i => (<tr key={i}><td className="bid-text">{depth.bids[i]?.price || '-'}</td><td>{depth.bids[i]?.orders || '-'}</td><td>{depth.bids[i]?.qty || '-'}</td><td className="ask-text">{depth.asks[i]?.price || '-'}</td><td>{depth.asks[i]?.orders || '-'}</td><td>{depth.asks[i]?.qty || '-'}</td></tr>))}</tbody></table>
                    <div style={{ padding: '20px', display: 'flex', gap: '4px', height: '8px', marginTop: 'auto' }}><div style={{ flex: 1, background: 'var(--border)', borderRadius: '4px', overflow: 'hidden' }}><div style={{ width: `${bidPct}%`, height: '100%', background: 'var(--blue)' }} /></div><div style={{ flex: 1, background: 'var(--border)', borderRadius: '4px', overflow: 'hidden' }}><div style={{ width: `${((depth.total_ask || 0) / (Math.max(depth.total_bid, depth.total_ask) || 1)) * 100}%`, height: '100%', background: 'var(--red)' }} /></div></div>
                </div>
            );
        };

        const AuthPage = ({ type, onAuth, onBack }) => {
            const [email, setEmail] = useState('demo@pro.com');
            const [pass, setPass] = useState('demo123');
            const [loading, setLoading] = useState(false);

            const handleGoogleLogin = async () => {
                if (!window.FirebaseAuth) { alert("Firebase not initialized. Check console."); return; }
                setLoading(true);
                try {
                    const { auth, signInWithPopup, GoogleAuthProvider } = window.FirebaseAuth;
                    const result = await signInWithPopup(auth, new GoogleAuthProvider());
                    onAuth({ name: result.user.displayName, email: result.user.email, photo: result.user.photoURL });
                } catch (error) {
                    console.error("Google Auth Error:", error);
                    alert("Google sign-in failed: " + error.message);
                } finally { setLoading(false); }
            };

            const handleSubmit = async (e) => {
                e.preventDefault(); setLoading(true);
                const r = await fetch(`/api/auth/${type.toLowerCase()}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, password: pass }) });
                const d = await r.json(); setLoading(false);
                if (d.status === 'success') onAuth(d.user || { name: 'Demo' }); else alert(d.message);
            };
            return (
                <div className="auth-container">
                    <div className="auth-card">
                        <button className="back-btn" onClick={onBack}>
                            <i className="fas fa-arrow-left"></i> Back to Home
                        </button>
                        <div className="logo" style={{ justifyContent: 'center', marginBottom: '30px' }} onClick={onBack}>
                            <i className="fas fa-landmark"></i>
                            <div style={{ display: 'flex', flexDirection: 'column', lineHeight: '1', textAlign: 'left' }}>
                                <div style={{ display: 'flex', gap: '4px', fontSize: '18px' }}>NIVARYA <span style={{ fontWeight: '300', opacity: 0.5 }}>SETU</span></div>
                                <div style={{ fontSize: '9px', fontWeight: '500', opacity: 0.4, letterSpacing: '0.3px', marginTop: '2px' }}>A bridge to smart investing</div>
                            </div>
                        </div>
                        <h2 className="auth-title" style={{ marginBottom: '20px', textAlign: 'center' }}>{type === 'LOGIN' ? 'Welcome Back' : 'Create Account'}</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="input-group" style={{ marginBottom: '20px' }}><label className="input-label">Email</label><input className="input-field" type="email" value={email} onChange={e => setEmail(e.target.value)} required /></div>
                            <div className="input-group" style={{ marginBottom: '25px' }}><label className="input-label">Password</label><input className="input-field" type="password" value={pass} onChange={e => setPass(e.target.value)} required /></div>
                            <button className="landing-btn" style={{ width: '100%', borderRadius: '6px', marginBottom: '15px', height: '48px', fontSize: '15px' }} disabled={loading}>{loading ? '...' : type}</button>
                        </form>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px', margin: '20px 0', color: 'var(--text-light)', fontSize: '11px' }}> <div style={{ flex: 1, height: '1px', background: 'var(--border)' }}></div> OR <div style={{ flex: 1, height: '1px', background: 'var(--border)' }}></div> </div>
                        <button className="action-btn" style={{ width: '100%', background: 'white', color: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px', height: '48px', borderRadius: '6px', fontSize: '14px', fontWeight: '600' }} onClick={handleGoogleLogin}>
                            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" /> Continue with Google
                        </button>
                        <p style={{ textAlign: 'center', marginTop: '25px', fontSize: '12px', color: 'var(--text-light)' }}> {type === 'LOGIN' ? "Don't have an account?" : "Already have an account?"} <span style={{ color: 'var(--green)', cursor: 'pointer', fontWeight: '700' }} onClick={() => onBack()}>{type === 'LOGIN' ? 'Sign Up' : 'Login'}</span> </p>
                    </div>
                </div>
            );
        };

        const LegalPage = ({ type, onBack }) => {
            const content = {
                PRIVACY: {
                    title: "Privacy Policy",
                    body: "At Nivarya Setu, we are committed to protecting your personal and financial data. We use industry-standard encryption and security protocols to ensure your information remains confidential. This policy outlines how we collect, use, and safeguard your data when you use our platform."
                },
                TERMS: {
                    title: "Terms & Conditions",
                    body: "By accessing Nivarya Setu, you agree to comply with our terms of service. Our platform provides technology solutions for trading and investing. Users are responsible for their own investment decisions and must adhere to all applicable financial regulations."
                },
                RISK: {
                    title: "Risk Disclosure",
                    body: "Trading in securities involves significant risks. Market volatility can lead to substantial financial loss. Nivarya Setu provides tools and data, but does not guarantee profits. Investors should assess their risk appetite before engaging in active trading."
                },
                REFUND: {
                    title: "Refund Policy",
                    body: "Subscription fees for Nivarya Setu premium services are generally non-refundable. However, we may consider refund requests for technical errors or duplicate payments. Trading losses are not subject to refund under any circumstances."
                }
            }[type] || { title: "Legal", body: "Legal information for Nivarya Setu." };

            return (
                <div style={{ background: 'var(--bg-main)', minHeight: '100vh', padding: '80px 20px' }}>
                    <div style={{ maxWidth: '800px', margin: '0 auto' }}>
                        <button className="back-btn" onClick={onBack} style={{ marginBottom: '40px' }}>
                            <i className="fas fa-arrow-left"></i> Back to Home
                        </button>
                        <h1 style={{ fontSize: '36px', fontWeight: '800', marginBottom: '32px', color: '#fff' }}>{content.title}</h1>
                        <div style={{ background: 'var(--bg-card)', padding: '48px', borderRadius: '24px', border: '1px solid var(--border)', lineHeight: '1.8', color: 'var(--text-light)', fontSize: '16px' }}>
                            <p>{content.body}</p>
                            <p style={{ marginTop: '24px', fontStyle: 'italic', opacity: 0.8 }}>This is a living document. As part of our commitment to transparency, we continuously update our legal frameworks to stay compliant with the latest fintech standards. For specific queries, please contact our support desk.</p>
                        </div>
                    </div>
                </div>
            );
        };

        const ScreenerDashboard = () => {
            const [filter, setFilter] = useState('ALL'); const [data, setData] = useState([]);
            useEffect(() => { fetch(`/api/screener?filter=${filter}`).then(r => r.json()).then(setData); }, [filter]);
            return (
                <div style={{ padding: '32px', height: '100%', overflow: 'auto' }}>
                    <div className="stock-title" style={{ marginBottom: '24px', fontSize: '24px' }}>Market Screener <span className="badge" style={{ background: 'var(--blue)', color: '#000', fontWeight: '700' }}>PRO</span></div>
                    <div style={{ display: 'flex', gap: '12px', marginBottom: '32px', flexWrap: 'wrap' }}>
                        {[{ k: 'ALL', l: 'All Stocks' }, { k: 'TOP_GAINERS', l: 'Top Gainers' }, { k: 'TOP_LOSERS', l: 'Top Losers' }, { k: 'RSI_OVERBOUGHT', l: 'Overbought' }, { k: 'RSI_OVERSOLD', l: 'Oversold' }].map(f => (
                            <button key={f.k} className="action-btn" style={{ background: filter === f.k ? 'var(--blue)' : 'var(--bg-card)', border: '1px solid var(--border)', color: filter === f.k ? '#000' : 'var(--text-light)', borderRadius: '100px', padding: '0 24px' }} onClick={() => setFilter(f.k)}>{f.l}</button>
                        ))}
                    </div>
                    <div style={{ background: 'var(--bg-card)', borderRadius: 'var(--radius)', border: '1px solid var(--border)', overflow: 'hidden' }}>
                        <table style={{ width: '100%', borderCollapse: 'separate', borderSpacing: '0' }}>
                            <thead>
                                <tr><th>Symbol</th><th>Sector</th><th>Price</th><th>Change</th><th>RSI</th><th>P/E</th><th>Volume</th></tr>
                            </thead>
                            <tbody>
                                {data.map(s => (
                                    <tr key={s.symbol}>
                                        <td style={{ fontWeight: '700', color: '#fff' }}>{s.symbol}</td>
                                        <td style={{ color: 'var(--text-light)' }}>{s.sector}</td>
                                        <td style={{ fontFamily: 'var(--font-mono)' }}>₹{s.price}</td>
                                        <td className={s.change > 0 ? 'text-up' : 'text-down'} style={{ fontWeight: '600' }}>{s.change}%</td>
                                        <td style={{ fontWeight: '700', color: s.rsi > 70 ? 'var(--red)' : s.rsi < 30 ? 'var(--green)' : 'var(--text-main)' }}>{s.rsi}</td>
                                        <td>{s.pe}</td>
                                        <td>{s.volume}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const ChartWidget = ({ symbol, onTrade }) => {
            const ref = useRef(null);
            const getTVSymbol = (s) => `BSE:${s ? s.replace('.NS', '') : "RELIANCE"}`;
            useEffect(() => {
                const tv = window.TradingView;
                if (tv && ref.current) {
                    ref.current.id = "tv_" + Math.random().toString(36).substr(2, 9);
                    try { new tv.widget({ "autosize": true, "symbol": getTVSymbol(symbol), "interval": "D", "timezone": "Asia/Kolkata", "theme": "dark", "style": "1", "toolbar_bg": "#141414", "hide_side_toolbar": false, "container_id": ref.current.id }); } catch (e) { }
                }
            }, [symbol]);
            return (
                <div style={{ width: '100%', height: '100%', position: 'relative' }}>
                    <div ref={ref} style={{ width: '100%', height: '100%' }}></div>
                    <div className="chart-trade-panel">
                        <button className="ct-btn ct-buy" title="Buy from Chart" onClick={() => onTrade('BUY')}><i className="fas fa-plus"></i></button>
                        <button className="ct-btn ct-sell" title="Sell from Chart" onClick={() => onTrade('SELL')}><i className="fas fa-minus"></i></button>
                    </div>
                </div>
            );
        };

        const InvestDashboard = ({ addToast }) => {
            const [section, setSection] = useState('STOCKCASES');
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                const fetchData = async () => {
                    let ep = '/api/invest/mutual_funds';
                    if (section === 'IPO') ep = '/api/invest/ipos';
                    if (section === 'BONDS') ep = '/api/invest/bonds';
                    if (section === 'STOCKCASES') ep = '/api/baskets';
                    try { const r = await fetch(ep); setData(await r.json()); } catch (e) { }
                };
                fetchData();
            }, [section]);

            const investBasket = async (id) => {
                setLoading(true);
                const r = await fetch('/api/place_basket', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ basket_id: id }) });
                const d = await r.json(); setLoading(false);
                if (d.status === 'success') addToast('success', 'Investment Successful', d.message);
                else addToast('error', 'Error', d.message);
            };

            return (
                <div style={{ padding: '32px', height: '100%', overflow: 'auto' }}>
                    <div style={{ display: 'flex', gap: '24px', marginBottom: '32px', borderBottom: '1px solid var(--border)', paddingBottom: '16px', overflowX: 'auto' }}>
                        {['STOCKCASES', 'MF', 'IPO', 'BONDS'].map(s => (
                            <div key={s} className={`nav-item ${section === s ? 'active' : ''}`} style={{ cursor: 'pointer', padding: '8px 0', borderBottom: section === s ? '2px solid var(--blue)' : 'none', borderRadius: '0', color: section === s ? 'var(--blue)' : 'var(--text-light)', fontWeight: '600' }} onClick={() => setSection(s)}>
                                {s === 'STOCKCASES' ? 'Stockcases' : s === 'MF' ? 'Mutual Funds' : s === 'IPO' ? 'IPOs' : 'Bonds & SGB'}
                            </div>
                        ))}
                    </div>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(320px, 1fr))', gap: '24px' }}>
                        {data.map((item, i) => (
                            <div key={i} style={{ background: 'var(--bg-card)', padding: '24px', borderRadius: 'var(--radius)', border: '1px solid var(--border)', transition: 'var(--transition)', display: 'flex', flexDirection: 'column' }}>
                                <div style={{ fontWeight: '700', marginBottom: '12px', fontSize: '18px', color: '#fff' }}>{item.name}</div>
                                {section === 'STOCKCASES' && (<>
                                    <p style={{ color: 'var(--text-light)', fontSize: '14px', marginBottom: '16px', lineHeight: '1.5', flex: 1 }}>{item.desc}</p>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: 'auto' }}>
                                        <div>
                                            <div style={{ fontSize: '11px', color: 'var(--text-light)', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Min Investment</div>
                                            <div style={{ fontWeight: '700', fontSize: '16px', color: '#fff' }}>₹{item.min_amt}</div>
                                        </div>
                                        <button className="landing-btn" style={{ padding: '10px 24px', fontSize: '14px' }} disabled={loading} onClick={() => investBasket(item.id)}>Buy Case</button>
                                    </div>
                                </>)}
                                {section === 'MF' && (<>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px', fontSize: '14px' }}>
                                        <div style={{ color: 'var(--text-light)' }}>3Y CAGR <span style={{ color: 'var(--green)', fontWeight: '700' }}>{item.cagr_3y}</span></div>
                                        <div style={{ color: 'var(--text-light)' }}>NAV ₹{item.nav}</div>
                                    </div>
                                    <div style={{ marginTop: 'auto' }}>
                                        <button className="landing-btn" style={{ width: '100%', fontSize: '14px' }} onClick={async () => { const r = await fetch('/api/invest/mf/sip', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name: item.name }) }); if (r.ok) addToast('success', 'SIP Started', `Monthly investment in ${item.name} active.`); }}>Start Monthly SIP</button>
                                    </div>
                                </>)}
                                {section === 'IPO' && (<>
                                    <div style={{ fontSize: '14px', color: 'var(--text-light)', marginBottom: '8px' }}>Price Range: <span style={{ color: '#fff' }}>₹{item.price_band}</span></div>
                                    <div style={{ fontSize: '14px', marginBottom: '20px' }}> Status: <span style={{ color: item.status === 'OPEN' ? 'var(--blue)' : 'var(--text-light)', fontWeight: '700' }}>{item.status}</span> </div>
                                    <div style={{ marginTop: 'auto' }}>
                                        <button className="landing-btn" disabled={item.status !== 'OPEN'} style={{ width: '100%', background: item.status === 'OPEN' ? 'var(--blue)' : 'rgba(255,255,255,0.05)', color: item.status === 'OPEN' ? '#000' : 'var(--text-light)', opacity: 1, fontSize: '14px' }} onClick={async () => { const r = await fetch('/api/invest/ipo/apply', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name: item.name }) }); if (r.ok) addToast('success', 'IPO Applied', `Application for ${item.name} submitted.`); }}>{item.status === 'OPEN' ? 'Apply Now' : 'Closed'}</button>
                                    </div>
                                </>)}
                                {section === 'BONDS' && (<>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }}>
                                        <div><div style={{ fontSize: '11px', color: 'var(--text-light)' }}>Yield</div><div style={{ color: 'var(--green)', fontWeight: '700' }}>{item.yield}</div></div>
                                        <div><div style={{ fontSize: '11px', color: 'var(--text-light)' }}>Maturity</div><div style={{ color: '#fff', fontWeight: '700' }}>{item.maturity}</div></div>
                                    </div>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: 'auto' }}>
                                        <div style={{ fontWeight: '700', fontSize: '18px', color: 'var(--blue)' }}>₹{item.price}</div>
                                        <button className="landing-btn" style={{ padding: '10px 24px', fontSize: '14px' }} onClick={async () => { const r = await fetch('/api/invest/bond/buy', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name: item.name, price: item.price }) }); if (r.ok) addToast('success', 'Investment Placed', `Bond purchase for ${item.name} confirmed.`); else addToast('error', 'Error', 'Insufficient funds'); }}>Invest</button>
                                    </div>
                                </>)}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const SettingsDashboard = ({ user, onUpdate, addToast }) => {
            const [name, setName] = useState(user?.name || '');
            const [email, setEmail] = useState(user?.email || '');
            const [password, setPassword] = useState('');
            const [saving, setSaving] = useState(false);

            const handleSave = async (e) => {
                e.preventDefault();
                setSaving(true);
                try {
                    const res = await fetch('/api/user/update', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, email, password })
                    });
                    const data = await res.json();
                    if (data.status === 'success') {
                        const updatedUser = { ...user, name, email };
                        localStorage.setItem('user', JSON.stringify(updatedUser));
                        onUpdate(updatedUser);
                        addToast('success', 'Profile Updated', 'Your settings have been saved.');
                    }
                } catch (e) {
                    addToast('error', 'Update Failed', 'An error occurred while saving.');
                }
                setSaving(false);
            };

            return (
                <div style={{ padding: '40px', maxWidth: '600px', margin: '0 auto', height: '100%', overflowY: 'auto' }}>
                    <div style={{ marginBottom: '32px' }}>
                        <h2 style={{ fontSize: '24px', fontWeight: '800', marginBottom: '8px' }}>Account Settings</h2>
                        <p style={{ color: 'var(--text-light)', fontSize: '14px' }}>Manage your profile information and security settings.</p>
                    </div>

                    <form onSubmit={handleSave} style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
                        <div className="input-group">
                            <label className="input-label" style={{ marginBottom: '8px', display: 'block' }}>Full Name</label>
                            <input className="input-field" value={name} onChange={e => setName(e.target.value)} placeholder="Enter your full name" required />
                        </div>

                        <div className="input-group">
                            <label className="input-label" style={{ marginBottom: '8px', display: 'block' }}>Email Address</label>
                            <input className="input-field" type="email" value={email} onChange={e => setEmail(e.target.value)} placeholder="yourname@example.com" required />
                        </div>

                        <div className="input-group">
                            <label className="input-label" style={{ marginBottom: '8px', display: 'block' }}>New Password</label>
                            <input className="input-field" type="password" value={password} onChange={e => setPassword(e.target.value)} placeholder="Leave blank to keep current password" />
                        </div>

                        <div style={{ marginTop: '16px', display: 'flex', gap: '16px' }}>
                            <button type="submit" className="landing-btn" style={{ padding: '12px 32px' }} disabled={saving}>
                                {saving ? 'Saving...' : 'Save Changes'}
                            </button>
                        </div>
                    </form>

                    <div style={{ marginTop: '48px', paddingTop: '32px', borderTop: '1px solid var(--border)' }}>
                        <div style={{ color: 'var(--red)', fontWeight: '700', fontSize: '14px', marginBottom: '8px' }}>Danger Zone</div>
                        <p style={{ color: 'var(--text-light)', fontSize: '12px', marginBottom: '16px' }}>Permanently close your account and remove all data.</p>
                        <button className="action-btn" style={{ background: 'transparent', border: '1px solid var(--red)', color: 'var(--red)', padding: '8px 16px' }}>
                            Deactivate Account
                        </button>
                    </div>
                </div>
            );
        };

        const OrderModal = ({ isOpen, type, symbol, price, onClose, onSubmit }) => {
            if (!isOpen) return null;
            const [qty, setQty] = useState(1); const [product, setProduct] = useState('MIS'); const [limitPrice, setLimitPrice] = useState(price); const [orderType, setOrderType] = useState('MARKET');
            useEffect(() => { if (orderType === 'MARKET') setLimitPrice(price); }, [price, orderType]);
            const isBuy = type === 'BUY'; const val = qty * (orderType === 'MARKET' ? price : limitPrice);
            return (<div className="modal-overlay"> <div className="modal"> <div className={`modal-header ${isBuy ? '' : 'sell'}`}> <div className="modal-title">{isBuy ? "BUY" : "SELL"} {symbol} <span style={{ fontSize: '11px', opacity: 0.8, marginLeft: '5px' }}>NSE</span></div> <div className="close-btn" onClick={onClose}><i className="fas fa-times"></i></div> </div> <div className="modal-body"> <div className="switch-toggle"> <div className={`switch-opt ${product === 'MIS' ? 'active' : ''}`} onClick={() => setProduct('MIS')}>INTRADAY <span style={{ fontSize: '9px' }}>MIS</span></div> <div className={`switch-opt ${product === 'CNC' ? 'active' : ''}`} onClick={() => setProduct('CNC')}>LONGTERM <span style={{ fontSize: '9px' }}>CNC</span></div> </div> <div className="input-row"> <div className="input-group"> <label className="input-label">Qty</label> <input type="number" className="input-field" value={qty} onChange={e => setQty(Math.max(1, e.target.value))} /> </div> <div className="input-group"> <label className="input-label">Price</label> <input type="number" className="input-field" value={orderType === 'MARKET' ? 0 : limitPrice} readOnly={orderType === 'MARKET'} placeholder={orderType === 'MARKET' ? 'MKT' : limitPrice} onChange={e => setLimitPrice(e.target.value)} /> </div> </div> <div className="switch-toggle" style={{ marginBottom: '0' }}> <div className={`switch-opt ${orderType === 'MARKET' ? 'active' : ''}`} onClick={() => setOrderType('MARKET')}>MKT</div> <div className={`switch-opt ${orderType === 'LIMIT' ? 'active' : ''}`} onClick={() => setOrderType('LIMIT')}>LMT</div> </div> </div> <div className="modal-footer"> <div style={{ fontSize: '12px', fontWeight: '500', color: 'var(--text-light)' }}>Margin: <span style={{ color: 'var(--text-main)', fontWeight: '600' }}>₹{val?.toLocaleString('en-IN', { maximumFractionDigits: 2 }) || '0'}</span></div> <div style={{ display: 'flex', gap: '10px' }}> <button className="action-btn" style={{ background: 'var(--bg-hover)', color: 'var(--text-main)', border: '1px solid var(--border)' }} onClick={onClose}>Cancel</button> <button className={`action-btn ${isBuy ? 'btn-buy' : 'btn-sell'}`} onClick={() => onSubmit({ qty, product, type: orderType, price: limitPrice })}>{type}</button> </div> </div> </div> </div>);
        };

        const WATCHLIST_DATA = {
            EQUITY: [
                { id: 'RELIANCE.NS', n: 'Reliance', def: 2450 },
                { id: 'TCS.NS', n: 'TCS', def: 3240 },
                { id: 'HDFCBANK.NS', n: 'HDFC Bank', def: 1650 },
                { id: 'INFY.NS', n: 'Infosys', def: 1420 },
                { id: 'SBIN.NS', n: 'SBI', def: 580 },
                { id: 'TATAMOTORS.NS', n: 'Tata Motors', def: 980 }
            ],
            FNO: [
                { id: 'NIFTY 25OCT FUT', n: 'NIFTY OCT FUT', def: 19650 },
                { id: 'BANKNIFTY 25OCT FUT', n: 'BANKNIFTY OCT FUT', def: 44500 },
                { id: 'NIFTY 19500 CE', n: 'NIFTY 19500 CE', def: 145 },
                { id: 'NIFTY 19500 PE', n: 'NIFTY 19500 PE', def: 85 }
            ],
            MCX: [
                { id: 'GOLD 05OCT FUT', n: 'GOLD', def: 59500 },
                { id: 'SILVER 05SEP FUT', n: 'SILVER', def: 74200 }
            ],
            CDS: [
                { id: 'USDINR 27SEP FUT', n: 'USDINR', def: 83.15 }
            ]
        };
        const ALL_SEGMENTS = [...WATCHLIST_DATA.EQUITY, ...WATCHLIST_DATA.FNO, ...WATCHLIST_DATA.MCX, ...WATCHLIST_DATA.CDS];

        const App = () => {
            const [view, setView] = useState(localStorage.getItem('auth') ? 'APP' : 'LANDING');
            const [user, setUser] = useState(JSON.parse(localStorage.getItem('user') || 'null'));
            const [portfolio, setPortfolio] = useState({ funds: 0, holdings: [], positions: [], orders: [], total_value: 0, total_pnl: 0 });
            const [indices, setIndices] = useState({ NIFTY: { price: 19500, chg: 0.5 }, BANKNIFTY: { price: 44000, chg: 0.4 } });
            const [watchlistTab, setWatchlistTab] = useState('EQUITY');
            const [tab, setTab] = useState('TRADE');
            const [symbol, setSymbol] = useState('RELIANCE.NS');
            const [qtys, setQtys] = useState({});
            const [modal, setModal] = useState({ open: false, type: 'BUY' });
            const [fundModal, setFundModal] = useState(false);
            const [toasts, setToasts] = useState([]);
            const [apiKey, setApiKey] = useState(null);
            const [profileMenu, setProfileMenu] = useState(false);
            const [txns, setTxns] = useState([]);
            const [search, setSearch] = useState('');

            const addToast = (type, title, message) => { const id = Date.now(); setToasts(prev => [...prev, { id, type, title, message }]); setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 4000); };
            const handleAuth = (userData) => { localStorage.setItem('auth', 'true'); localStorage.setItem('user', JSON.stringify(userData)); setUser(userData); setView('APP'); addToast('success', 'Access Granted', `Welcome back, ${userData.name}`); };
            const logout = () => { localStorage.clear(); setView('LANDING'); setUser(null); };

            const refreshData = async () => { if (view !== 'APP' || document.hidden) return; try { const s = ALL_SEGMENTS.map(x => x.id).join(','); const r1 = await fetch(`/api/batch_quotes?symbols=${s}`); if (r1.ok) { const d1 = await r1.json(); if (d1 && !d1.error) { setQtys(prev => ({ ...prev, ...d1 })); setIndices(d1.indices); } } } catch (e) { } try { const r2 = await fetch('/api/portfolio'); if (r2.ok) setPortfolio(await r2.json()); } catch (e) { } };
            useEffect(() => { refreshData(); const t = setInterval(refreshData, 3000); return () => clearInterval(t); }, [view]);
            useEffect(() => { if (tab === 'FUNDS') fetch('/api/funds/history').then(r => r.json()).then(setTxns); }, [tab]);

            const placeOrder = async (orderData) => { const payload = { symbol, side: modal.type, ...orderData, price: parseFloat(orderData.price) }; try { const res = await fetch('/api/place_order', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); const d = await res.json(); setModal({ ...modal, open: false }); if (d.status === 'success') { refreshData(); addToast('success', 'Order Executed', `${modal.type} ${symbol} successful`); } else addToast('error', 'Order Rejected', d.message); } catch (e) { addToast('error', 'Error', 'Failed to place order'); } };
            const squareOff = async (symbol) => { try { const res = await fetch('/api/square_off', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ symbol }) }); const d = await res.json(); if (d.status === 'success') { addToast('success', 'Position Closed', `Exited ${symbol}`); refreshData(); } else addToast('error', 'Failed', d.message); } catch (e) { } };
            const addFunds = async (amt) => { await fetch('/api/add_funds', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ amount: amt }) }); setFundModal(false); refreshData(); addToast('success', 'Funds Added', `Added ₹${amt.toLocaleString()}`); if (tab === 'FUNDS') fetch('/api/funds/history').then(r => r.json()).then(setTxns); };

            if (view === 'LANDING') return <LandingPage onStart={setView} />;
            if (view === 'LOGIN' || view === 'SIGNUP') return <AuthPage type={view} onAuth={handleAuth} onBack={() => setView('LANDING')} />;
            if (['PRIVACY', 'TERMS', 'RISK', 'REFUND'].includes(view)) return <LegalPage type={view} onBack={() => setView('LANDING')} />;

            const fmt = (n) => n?.toLocaleString('en-IN', { minimumFractionDigits: 2 }) || '0.00';
            const col = (n) => n >= 0 ? 'text-up' : 'text-down';
            const curPrice = qtys[symbol]?.price || ALL_SEGMENTS.find(x => x.id === symbol)?.def || 0;

            return (
                <div style={{ height: '100vh', display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
                    <ToastContainer toasts={toasts} />
                    <OrderModal isOpen={modal.open} type={modal.type} symbol={symbol} price={curPrice} onClose={() => setModal({ ...modal, open: false })} onSubmit={placeOrder} />
                    {fundModal && <div className="modal-overlay"><div className="modal" style={{ width: '320px' }}><div className="modal-header"><div className="modal-title">Add Funds</div><div className="close-btn" onClick={() => setFundModal(false)}>x</div></div><div className="modal-body" style={{ textAlign: 'center' }}><p style={{ marginBottom: '20px', color: 'var(--text-light)' }}>Instant funding via Simulator Gateway</p><button className="action-btn btn-buy" style={{ width: '100%', marginBottom: '10px' }} onClick={() => addFunds(10000)}>+ ₹10,000</button><button className="action-btn btn-buy" style={{ width: '100%', background: 'var(--bg-active)', border: '1px solid var(--border)' }} onClick={() => addFunds(50000)}>+ ₹50,000</button></div></div></div>}
                    <div className="header">
                        <div className="logo" onClick={() => setTab('TRADE')}>
                            <i className="fas fa-landmark"></i>
                            <div style={{ display: 'flex', flexDirection: 'column', lineHeight: '1' }}>
                                <div style={{ display: 'flex', gap: '4px', fontSize: '18px' }}>NIVARYA <span style={{ fontWeight: '300', opacity: 0.5 }}>SETU</span></div>
                                <div style={{ fontSize: '9px', fontWeight: '500', opacity: 0.4, letterSpacing: '0.3px', marginTop: '2px' }}>A bridge to smart investing</div>
                            </div>
                        </div>
                        <div className="indices">
                            <div className="index-item">NIFTY 50 <span className="index-val">{fmt(indices.NIFTY?.price)}</span> <span className={`index-chg ${col(indices.NIFTY?.chg)}`}>{indices.NIFTY?.chg > 0 ? '+' : ''}{fmt(indices.NIFTY?.chg)}%</span></div>
                            <div className="index-item">BANKNIFTY <span className="index-val">{fmt(indices.BANKNIFTY?.price)}</span> <span className={`index-chg ${col(indices.BANKNIFTY?.chg)}`}>{indices.BANKNIFTY?.chg > 0 ? '+' : ''}{fmt(indices.BANKNIFTY?.chg)}%</span></div>
                        </div>
                        <div className="nav">
                            {['TRADE', 'INVEST', 'ORDERS', 'HOLDINGS', 'POSITIONS', 'FUNDS', 'SCREENER'].map(t => (
                                <div key={t} className={`nav-item ${tab === t ? 'active' : ''}`} onClick={() => setTab(t)}>
                                    {t.charAt(0) + t.slice(1).toLowerCase()}
                                </div>
                            ))}
                        </div>
                        <div className="user-info" onClick={(e) => { e.stopPropagation(); setProfileMenu(!profileMenu); }}>
                            <div style={{ color: 'var(--green)', fontWeight: '700' }}>₹{fmt(portfolio.funds)}</div>
                            <div className="user-avatar">{user?.name[0] || 'U'}</div>
                            {profileMenu && (
                                <div className="profile-dropdown">
                                    <div className="dropdown-info">
                                        <div style={{ fontWeight: '700', marginBottom: '4px' }}>{user?.name}</div>
                                        <div style={{ fontSize: '10px', color: 'var(--text-light)' }}>{user?.email}</div>
                                    </div>
                                    <div className="dropdown-item" onClick={() => { setTab('SETTINGS'); setProfileMenu(false); }}>
                                        <i className="fas fa-user-cog"></i> Profile Settings
                                    </div>
                                    <div className="dropdown-item" onClick={() => { fetch('/api/generate_key', { method: 'POST' }).then(r => r.json()).then(setApiKey); setProfileMenu(false); }}>
                                        <i className="fas fa-code"></i> API Access
                                    </div>
                                    <div className="dropdown-item text-down" onClick={logout}>
                                        <i className="fas fa-sign-out-alt"></i> Logout
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="main">
                        {tab === 'TRADE' && (
                            <div className="sidebar">
                                <div className="search-area">
                                    <i className="fas fa-search"></i>
                                    <input className="search-input" placeholder="Search Symbols..." value={search} onChange={e => setSearch(e.target.value)} />
                                </div>
                                <div style={{ display: 'flex', borderBottom: '1px solid var(--border)', background: 'var(--bg-panel)' }}>
                                    {['EQUITY', 'FNO', 'MCX', 'CDS'].map(s => (
                                        <div key={s} className={`panel-tab ${watchlistTab === s ? 'active' : ''}`} style={{ flex: 1, textAlign: 'center' }} onClick={() => setWatchlistTab(s)}>{s}</div>
                                    ))}
                                </div>
                                <div className="stock-list custom-scroll">
                                    {WATCHLIST_DATA[watchlistTab].filter(w => w.n.toLowerCase().includes(search.toLowerCase()) || w.id.toLowerCase().includes(search.toLowerCase())).map(w => {
                                        const change = qtys[w.id]?.change || 0;
                                        return (
                                            <div key={w.id} className={`stock-item ${symbol === w.id ? 'active' : ''}`} onClick={() => setSymbol(w.id)}>
                                                <div className="symbol-info">
                                                    <div>{w.n}</div>
                                                    <div>{w.id.includes('NIFTY') ? 'NFO' : 'NSE'}</div>
                                                </div>
                                                <div style={{ flex: 1, display: 'flex', justifyContent: 'center' }}><Sparkline color={change >= 0 ? 'var(--green)' : 'var(--red)'} /></div>
                                                <div className="price-info">
                                                    <div className={`price-val ${col(change)}`}>{fmt(qtys[w.id]?.price || w.def)}</div>
                                                    <div className="price-chg">{change > 0 ? '+' : ''}{fmt(change)}%</div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        <div className="content" style={{ flex: 1, display: 'flex', flexDirection: 'column' }} onClick={() => setProfileMenu(false)}>
                            {tab !== 'TRADE' && tab !== 'LANDING' && (
                                <div style={{ padding: '20px 40px 0' }}>
                                    <button className="back-btn" onClick={() => setTab('TRADE')} style={{ marginBottom: '10px' }}>
                                        <i className="fas fa-arrow-left"></i> Back to Trading Terminal
                                    </button>
                                </div>
                            )}
                            {tab === 'TRADE' && (
                                <>
                                    <div className="info-bar">
                                        <div className="stock-title">{symbol} <span className="badge">NSE</span></div>
                                        <div className="stock-ltp" style={{ color: col(qtys[symbol]?.change) }}>{fmt(qtys[symbol]?.price || curPrice)}</div>
                                        <div className="actions">
                                            <button className="action-btn btn-buy" onClick={() => setModal({ open: true, type: 'BUY' })}>BUY</button>
                                            <button className="action-btn btn-sell" onClick={() => setModal({ open: true, type: 'SELL' })}>SELL</button>
                                        </div>
                                    </div>
                                    <div className="center-area">
                                        <div className="chart-container">
                                            <ChartWidget symbol={symbol} onTrade={(t) => setModal({ open: true, type: t })} />
                                        </div>
                                        <MarketDepth symbol={symbol} />
                                    </div>
                                </>
                            )}
                            {tab === 'INVEST' && <InvestDashboard addToast={addToast} />}
                            {tab === 'SCREENER' && <ScreenerDashboard />}
                            {tab === 'SETTINGS' && <SettingsDashboard user={user} onUpdate={setUser} addToast={addToast} />}
                            {tab === 'FUNDS' && (
                                <div style={{ padding: '40px', height: '100%', overflow: 'auto' }}>
                                    <div className="funds-card" style={{ background: 'var(--bg-panel)', padding: '32px', borderRadius: '16px', border: '1px solid var(--border)', display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '32px' }}>
                                        <div>
                                            <div style={{ color: 'var(--text-light)', fontSize: '12px', fontWeight: '700', marginBottom: '8px', textTransform: 'uppercase', letterSpacing: '1px' }}>Available Margin</div>
                                            <div style={{ fontSize: '36px', fontWeight: '900', fontFamily: 'var(--font-mono)' }}>₹ {fmt(portfolio.funds)}</div>
                                        </div>
                                        <button className="landing-btn" style={{ padding: '14px 32px' }} onClick={() => setFundModal(true)}>Add Funds</button>
                                    </div>
                                    <div className="stock-title" style={{ marginBottom: '20px' }}>Transaction Ledger</div>
                                    <table style={{ width: '100%' }}>
                                        <thead><tr><th>Time</th><th>Description</th><th>Type</th><th>Amount</th><th>Balance</th></tr></thead>
                                        <tbody>
                                            {txns.map(t => (
                                                <tr key={t.id}>
                                                    <td style={{ color: 'var(--text-light)', fontSize: '11px' }}>{t.time}</td>
                                                    <td style={{ fontWeight: '600' }}>{t.desc}</td>
                                                    <td><span className="badge">{t.type}</span></td>
                                                    <td className={t.amount > 0 ? 'text-up' : 'text-down'}>{fmt(t.amount)}</td>
                                                    <td>₹{fmt(t.bal)}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            )}
                            {(['HOLDINGS', 'POSITIONS', 'ORDERS'].includes(tab)) && (
                                <div className="table-area custom-scroll" style={{ padding: '20px' }}>
                                    <div className="stock-title" style={{ marginBottom: '20px' }}>{tab.charAt(0) + tab.slice(1).toLowerCase()}</div>
                                    {(tab === 'HOLDINGS' && portfolio.holdings?.length === 0 || tab === 'POSITIONS' && portfolio.positions?.length === 0 || tab === 'ORDERS' && portfolio.orders?.length === 0) ? (
                                        <EmptyState icon="fa-folder-open" text={`No ${tab.toLowerCase()} found.`} />
                                    ) : (
                                        <table style={{ width: '100%' }}>
                                            <thead>
                                                {tab === 'HOLDINGS' ? <tr><th>Instrument</th><th>Qty</th><th>Avg.</th><th>LTP</th><th>Value</th><th>P&L</th></tr> :
                                                    tab === 'POSITIONS' ? <tr><th>Instrument</th><th>Qty</th><th>Avg.</th><th>LTP</th><th>P&L</th><th>Action</th></tr> :
                                                        <tr><th>Time</th><th>Type</th><th>Symbol</th><th>Qty</th><th>Price</th><th>Status</th></tr>}
                                            </thead>
                                            <tbody>
                                                {tab === 'HOLDINGS' && portfolio.holdings.map(h => (
                                                    <tr key={h.symbol}>
                                                        <td style={{ fontWeight: '700' }}>{h.symbol}</td><td>{h.qty}</td><td>{fmt(h.avg)}</td>
                                                        <td className={col(h.ltp - h.avg)}>{fmt(h.ltp)}</td><td>{fmt(h.value)}</td>
                                                        <td className={col(h.pnl)}>{fmt(h.pnl)} ({h.pnl_pct}%)</td>
                                                    </tr>
                                                ))}
                                                {tab === 'POSITIONS' && portfolio.positions.map(p => (
                                                    <tr key={p.symbol}>
                                                        <td style={{ fontWeight: '700' }}>{p.symbol}</td><td>{p.qty}</td><td>{fmt(p.avg)}</td>
                                                        <td className={col(p.pnl)}>{fmt(p.ltp)}</td><td className={col(p.pnl)}>{fmt(p.pnl)}</td>
                                                        <td><button className="action-btn" style={{ height: '26px', fontSize: '10px', background: 'var(--red)', color: 'white', border: 'none', padding: '0 12px' }} onClick={() => squareOff(p.symbol)}>EXIT</button></td>
                                                    </tr>
                                                ))}
                                                {tab === 'ORDERS' && portfolio.orders.map((o, i) => (
                                                    <tr key={i}>
                                                        <td style={{ color: 'var(--text-light)', fontSize: '11px' }}>{o.time}</td>
                                                        <td><span className={`badge ${o.type.toLowerCase()}`} style={{ color: o.type === 'BUY' ? 'var(--blue)' : 'var(--red)' }}>{o.type}</span></td>
                                                        <td style={{ fontWeight: '700' }}>{o.symbol}</td><td>{o.qty}</td><td>{fmt(o.price)}</td>
                                                        <td><span className="badge" style={{ color: 'var(--green)' }}>COMPLETED</span></td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root')); root.render(<ErrorBoundary><App /></ErrorBoundary>);
    </script>
</body>

</html>